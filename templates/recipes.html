{%extends 'base.html'%}{%block content%}
<h2 class="text-center">Recipes</h2>
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class=flashes>
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
<p>Total Recipes: {{recipes_count}}</p>
<div class="mt-5">
    <form action="{{url_for('recipes')}}" method="GET">
        <input  type="hidden" name="keyword" value="{{keyword if keyword}}" />
        <div class="form-row">
            <div class="form-group col-12 col-md-4">
                <label for="browse">Select diet OR cuisine</label>
                <select class="form-control selectpicker" name="browse" id="browse">
                    <option disabled selected>Browse</option>
                    <optgroup label="Diet">
                        {% for diet in _diet %}
                        <option {{"selected" if ('browse' in filters) and (filters['browse'] == diet.diet_name)}}>{{diet.diet_name}}</option>
                        {% endfor %}
                        </optgroup>
                    <optgroup label="Cuisine">
                        {%for cuisine in _cuisine %}
                        <option {{"selected" if ('browse' in filters) and (filters['browse'] == cuisine.cuisine_name)}}>{{cuisine.cuisine_name}}</option>
                        {% endfor %}
                    </optgroup>
                    <optgroup label="Select All">
                         <option>All</option>
                    </optgroup>
                </select>
            </div>
            <div class="form-group col-12 col-md-4 ">
                <label for="sort">Sort</label>
                <select class="selectpicker form-control" name="sort" id="sort">
                    <option {{"selected" if ('sort' in filters) and (filters['sort']=="Latest Entry First")}}>Latest Entry First</option>
                    <option {{"selected" if ('sort' in filters) and (filters['sort']=="Oldest Entry First")}}>Oldest Entry First</option>
                    <option {{"selected" if ('sort' in filters) and (filters['sort']=="Most viewed on top")}}>Most viewed on top</option>
                </select>
            </div>
            <div class="form-group col-12 col-md-4 ">
                <label for="exclude_allergy">EXCLUDE Allergens</label>
                <select class="selectpicker form-control" data-style ="btn-light btn-new" name="exclude_allergy[]" multiple>
                    {%for allergen in _allergens%}
                    {%if allergen.allergen_type != "none"%}
                        <option {{"selected" if ('exclude' in filters) and (allergen.allergen_type in filters['exclude'])}}>{{allergen.allergen_type}}</option>
                    {%endif%}    
                    {%endfor%}
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary" name="submit">Apply</button>
    </form>
</div>

<div class="row mt-3">
    {% for recipe in recipes %} {% if loop.index0 < page_size %} 
    <div class="col-md-6 col-lg-3">
        <a class="text-reset" href="{{url_for('view_recipe',recipe_id=recipe._id)}}">
            <div class="img-container" style="background-image: url({{recipe['image']}}); background-size: cover; padding-top: 60%;"> </div>
            <h5>{{recipe['title']}}</h5>
            {{recipe._id.generation_time.strftime("%d %b %Y, %H:%M")}}
        </a>
    </div>
{% endif %} {%endfor%}
</div>
<div class="row mt-4 clearfix">
    {% if page >1 %}
    <div class="col float-left">
        <form action="{{url_for('recipes',page=page-1)}}" method="GET">
            {%if keyword %}
            <input type="hidden" name="keyword" value="{{keyword}}" /> {%endif%} {%if 'browse' in filters%}
            <input type="hidden" value="{{filters['browse']}}" name="browse"> {%endif%} {%if 'sort' in filters%}
            <input type="hidden" value="{{filters['sort']}}" name="sort"> {%endif%}

            <div class="col">
                <button type="submit" class="btn btn-primary" name="submit" value="previous-page">Previous Page</button>
            </div>
        </form>
    </div>
    {% endif%}
    <div class="col">
        Current Page:{{page}}
    </div>
    {% if recipes_length > page_size %}
    <div class="col float-right">
        <form action="{{url_for('recipes',page=page+1)}}" method="GET">
            {%if keyword %}
            <input type="hidden" name="keyword" value="{{keyword}}" /> {%endif%} {%if 'browse' in filters%}
            <input type="hidden" value="{{filters['browse']}}" name="browse"> {%endif%} {%if 'sort' in filters%}
            <input type="hidden" value="{{filters['sort']}}" name="sort"> {%endif%}

            <div class="col">
                <button type="submit" class="btn btn-primary" name="submit" value="next-page">Next Page</button>
            </div>
        </form>
    </div>
    {%endif%}
</div>
{%endblock%}
